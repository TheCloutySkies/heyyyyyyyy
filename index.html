<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Clouty Skies</title>
  <meta name="description" content="Clouty Skies — Windows 7-style personal site, games, blog, and portfolio." />
  <meta property="og:title" content="Clouty Skies" />
  <meta property="og:description" content="Windows 7-style personal site, games, blog, and portfolio." />
  <meta property="og:image" content="/Net003_result.png" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Clouty Skies" />
  <meta name="twitter:description" content="Windows 7-style personal site, games, blog, and portfolio." />
  <meta name="twitter:image" content="/Net003_result.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/Net003.ico" />
  <link rel="apple-touch-icon" sizes="180x180" href="Img29_(Windows_Vista).jpg" />
  <meta name="theme-color" content="#0a5fad" />
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet" href="https://unpkg.com/7.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root { --desk-gap: 14px; --maxw: 1024px; --glass-bg: rgba(255,255,255,.65); --glass-border: rgba(0,0,0,.12); --text-color: #1b1b1b; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: "Segoe UI", Tahoma, Arial, sans-serif;
      background: #0a5fad url("Img29_(Windows_Vista).jpg") center/cover fixed;
    }
    @media (max-width: 820px) {
      body { background-attachment: scroll; }
    }
    .topbar-wrap { position: sticky; top: 0; z-index: 9999; margin: 0; }
    .topbar-bg { background: var(--glass-bg); backdrop-filter: blur(6px); border-bottom: 1px solid rgba(0,0,0,.1); }
    .menubar { max-width: var(--maxw); margin: 0 auto; padding: 0 6px; }
    .menubar ul[role="menubar"] { margin: 0; }
    .stack { max-width: var(--maxw); margin: 12px auto; padding: 12px; display: flex; flex-direction: column; gap: var(--desk-gap); }
    .window { width: 100%; }
    .hero-wall { background: rgba(255,255,255,.5); }
    .icons { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    .icons a { text-decoration: none; color: inherit; }
    .icons figure { margin: 0; text-align: center; }
    .icons img { width: 48px; height: 48px; display: block; margin: 8px auto 6px; }
    #boot { position: fixed; inset: 0; display: grid; place-items: center; background: rgba(0,0,0,.35); z-index: 10000; }
    #boot .window { max-width: 420px; }
    body.is-mobile { background-attachment: scroll; }
    body.is-mobile ul[role="menubar"] { overflow-x: auto; white-space: nowrap; }
    body.is-mobile .window { max-width: 100%; }
    body.is-mobile .icons img { width: 40px; height: 40px; }
    #spotify-player-container.window { position: fixed; bottom: 20px; right: 20px; width: 320px; z-index: 1000; box-shadow: 0 8px 32px rgba(0,0,0,0.25); }
    #spotify-player-container.hidden { transform: translateX(110%); transition: transform .35s ease; }
    #spotify-player-container .window-body { padding: 8px; }
    .spotify-iframe-wrapper { height: 100px; transition: height 0.3s ease, opacity 0.3s ease; opacity: 1; }
    #spotify-player-container.minimized .spotify-iframe-wrapper { height: 0; opacity: 0; overflow: hidden; }
    .skip-link {
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
      z-index: 10001;
      background: #fff;
      color: #0a5fad;
      border-radius: 4px;
      padding: 8px 16px;
      font-weight: bold;
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    .skip-link:focus {
      left: 16px;
      top: 16px;
      width: auto;
      height: auto;
      outline: 2px solid #0a5fad;
    }
    /* New CSS for Sticky Notes */
.note {
  position: absolute;
  min-width: 120px;
  max-width: 240px;
  padding: 8px 10px;
  border: 1px solid rgba(0,0,0,.15);
  border-radius: 6px;
  box-shadow: 0 2px 10px rgba(0,0,0,.15);
  cursor: move;
  user-select: none;
  white-space: pre-wrap;
}
.note .note-actions { display: flex; gap: 6px; justify-content: flex-end; margin-top: 6px; }
.note .note-btn { border: 1px solid rgba(0,0,0,.12); background: rgba(255,255,255,.6); padding: 2px 6px; border-radius: 4px; cursor: pointer; }

    @media (prefers-reduced-motion: reduce) {
      progress.marquee { animation: none !important; }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to content</a>
  <div id="boot" role="dialog" aria-labelledby="boot-title">
    <div class="window glass is-bright">
      <div class="title-bar">
        <div class="title-bar-text" id="boot-title">Starting Up CloutOS</div>
        <div class="title-bar-controls">
          <button aria-label="Close" onclick="dismissBoot(true)"></button>
        </div>
      </div>
      <div class="window-body has-space">
        <div class="field-row" style="align-items:center; gap:8px">
          <progress class="marquee" style="width:100%" aria-label="Loading"></progress>
          <span>Loading…</span>
        </div>
        <div style="text-align:right; margin-top: 10px">
          <button class="button" onclick="dismissBoot(true)">Enter</button>
        </div>
      </div>
    </div>
  </div>
  <div class="topbar-wrap" id="menu">
    <div class="topbar-bg">
      <div class="menubar">
        <ul role="menubar" class="can-hover">
          <li role="menuitem" tabindex="0" aria-haspopup="true">
            File
            <ul role="menu">
              <li role="menuitem"><a href="index.html">Home</a></li>
              <li role="menuitem"><a href="about.html">About</a></li>
              <li role="menuitem"><a href="blog.html">Blog</a></li>
              <li role="menuitem" class="has-divider"><a href="watch.html">Watch</a></li>
            </ul>
          </li>
          <li role="menuitem" tabindex="0" aria-haspopup="true">
            Links
            <ul role="menu">
              <li role="menuitem"><a href="https://lonniejohnston.com" target="_blank" rel="noopener">Portfolio</a></li>
              <li role="menuitem"><a href="https://www.youtube.com/@CloutySkies" target="_blank" rel="noopener">Main Channel</a></li>
              <li role="menuitem"><a href="https://www.youtube.com/@CloutySkies2" target="_blank" rel="noopener">Second Channel</a></li>
              <li role="menuitem"><a href="https://www.instagram.com/thecloutyskies" target="_blank" rel="noopener">Instagram</a></li>
              <li role="menuitem"><a href="https://www.tiktok.com/@clouty_skies" target="_blank" rel="noopener">TikTok</a></li>
              <li role="menuitem"><a href="https://open.spotify.com/artist/3QbHatr8OY2onxDhLD4dmC" target="_blank" rel="noopener">Spotify</a></li>
              <li role="menuitem"><a href="https://soundcloud.com/clouty-skies-extras" target="_blank" rel="noopener">SoundCloud</a></li>
              <li role="menuitem"><a href="https://www.redbubble.com/people/cloutyskies/shop" target="_blank" rel="noopener">Merch</a></li>
            </ul>
          </li>
          <li role="menuitem" tabindex="0" aria-haspopup="true">
            Gaming
            <ul role="menu">
              <li role="menuitem"><a href="cloutris.html">Cloutris</a></li>
              <li role="menuitem"><a href="clouty-hops.html">Clouty Hops</a></li>
              <li role="menuitem"><a href="tic.html">Clouty Toes</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <main class="stack" id="main-content">
    <section class="window glass active hero-wall">
      <div class="title-bar">
        <div class="title-bar-text">Computer — Clouty Skies</div>
        <div class="title-bar-controls">
          <button aria-label="Minimize"></button>
          <button aria-label="Maximize"></button>
          <button aria-label="Close"></button>
        </div>
      </div>
      <div class="window-body has-space">
        <menu role="tablist" aria-label="Sections">
          <button role="tab" aria-controls="tab-home" aria-selected="true">Home</button>
          <button role="tab" aria-controls="tab-media">Media</button>
          <button role="tab" aria-controls="tab-games">Games</button>
        </menu>
        <article role="tabpanel" id="tab-home">
          <fieldset>
            <legend>Folders</legend>
            <div class="icons" aria-label="Site navigation">
              <a href="about.html"><figure><img alt="About" src="https://unpkg.com/emoji-datasource-apple/img/apple/64/1f464.png" /><figcaption>About</figcaption></figure></a>
              <a href="blog.html"><figure><img alt="Blog" src="https://unpkg.com/emoji-datasource-apple/img/apple/64/1f4d1.png" /><figcaption>8,000 MofM Blog</figcaption></figure></a>
              <a href="watch.html"><figure><img alt="Watch" src="https://www.rw-designer.com/icon-image/23999-48x48x8.png" /><figcaption>Watch</figcaption></figure></a>
            </div>
          </fieldset>
        </article>
        <article role="tabpanel" id="tab-media" hidden>
          <fieldset>
            <legend>Links</legend>
            <div class="group">
              <div><a class="button" href="https://www.youtube.com/@CloutySkies" target="_blank">YouTube</a></div>
              <div><a class="button" href="https://www.instagram.com/cloutyskies" target="_blank">Instagram</a></div>
              <div><a class="button" href="https://www.tiktok.com/@cloutyskies" target="_blank" rel="noopener">TikTok</a></div>
            </div>
          </fieldset>
        </article>
        <article role="tabpanel" id="tab-games" hidden>
          <fieldset>
            <legend>Games</legend>
            <div class="group">
              <div><a class="button" href="cloutris.html">Cloutris</a></div>
              <div><a class="button" href="clouty-hops.html">Clouty Hops</a></div>
              <div><a class="button" href="tic.html">Clouty Toes</a></div>
            </div>
          </fieldset>
        </article>
        <section class="window" style="margin-top:24px;">
          <div class="title-bar">
            <div class="title-bar-text">Photography Portfolio</div>
          </div>
          <div class="window-body has-space">
            <p>To view my photography portfolio, please visit <a href="https://lonniejohnston.com" target="_blank" rel="noopener">lonniejohnston.com</a>.</p>
          </div>
        </section>
      </div>
      <div class="status-bar">
        <p class="status-bar-field">Ready</p>
        <p class="status-bar-field">Items: 7</p>
        <p class="status-bar-field">© Clouty Skies</p>
      </div>
    </section>

    <!-- Sticky Notes Section -->
    <section id="notes-window" class="window glass">
      <div class="title-bar">
        <div class="title-bar-text">Sticky Notes</div>
        <div class="title-bar-controls">
          <button aria-label="Minimize"></button>
          <button aria-label="Maximize" disabled></button>
          <button aria-label="Close"></button>
        </div>
      </div>
      <div class="window-body has-space">
        <form id="note-form" class="group">
          <input id="note-input" maxlength="140" placeholder="Leave a short note (max 140 chars)" />
          <select id="note-color">
            <option value="#fff8b0">Yellow</option>
            <option value="#c9f5ff">Blue</option>
            <option value="#d5ffd3">Green</option>
            <option value="#ffd4e5">Pink</option>
          </select>
          <button type="submit" class="button default">Pin</button>
        </form>
        <div id="notes-canvas" style="position:relative; min-height:220px;"></div>
      </div>
    </section>

    <!-- Windows 7–styled Command Prompt -->
    <section id="cmd-window" class="window glass">
      <div class="title-bar">
        <div class="title-bar-text">Command Prompt</div>
        <div class="title-bar-controls">
          <button aria-label="Minimize"></button>
          <button aria-label="Maximize" disabled></button>
          <button aria-label="Close"></button>
        </div>
      </div>
      <div class="window-body has-space">
        <div id="cmd-screen" style="background:#000;color:#0f0;font-family:Consolas,monospace; padding:10px; height:260px; overflow:auto; border:1px solid #333;">
          <div>CloutySkiesIntelligence (CSI) [Version 6.1.7601]</div>
          <div>(c) CloutAI Protocol V.1.02. All rights reserved.</div>
          <div></div>
        </div>
        <div class="field-row" style="margin-top:8px;">
          <label for="cmd-input">C:\Users\Guest&gt;</label>
          <input id="cmd-input" placeholder="type help" autocomplete="off" />
        </div>
      </div>
    </section>
  </main>

  <div id="spotify-player-container" class="window glass is-bright">
    <div class="title-bar">
      <div class="title-bar-text">Spotify Player</div>
      <div class="title-bar-controls">
        <button id="spotify-minimize" aria-label="Minimize"></button>
        <button aria-label="Maximize" disabled></button>
        <button id="spotify-close" aria-label="Close"></button>
      </div>
    </div>
    <div class="window-body">
      <div class="spotify-iframe-wrapper">
        <iframe style="border:0; border-radius:8px;" src="https://open.spotify.com/embed/artist/3QbHatr8OY2onxDhLD4dmC?utm_source=generator&theme=0" width="100%" height="100%" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>
      </div>
    </div>
  </div>

  <script>
    (function(){
      if (window.__cloutyInit) return;
      window.__cloutyInit = true;
      // Boot screen: skip for 24h if visited
      if (localStorage.getItem('cloutyBootSkip') === '1') {
        document.getElementById('boot').style.display = 'none';
      } else {
        window.bootTimer = setTimeout(()=>window.dismissBoot(false), 2500);
      }
      window.dismissBoot = function(){
        const b=document.getElementById('boot');
        if(!b)return;
        b.style.display='none';
        if(window.bootTimer){clearTimeout(window.bootTimer);window.bootTimer=null;}
        localStorage.setItem('cloutyBootSkip','1');
        setTimeout(()=>{
          localStorage.setItem('cloutyBootSkip','0');
        }, 24*60*60*1000);
      };
      // Menu bar: tap-to-toggle for mobile
      document.querySelectorAll('.menubar [role="menuitem"]').forEach(function(item){
        item.addEventListener('touchstart',function(e){
          if(document.body.classList.contains('is-mobile')){
            e.stopPropagation();
            document.querySelectorAll('.menubar [role="menuitem"]').forEach(function(i){
              if(i!==item) i.classList.remove('active');
            });
            item.classList.toggle('active');
          }
        });
      });
      // Tabs
      (function(){
        const explorer = document.querySelector('section.window.hero-wall');
        if(!explorer) return;
        const tabs = explorer.querySelectorAll('[role="tab"]');
        const panels = explorer.querySelectorAll('[role="tabpanel"]');
        tabs.forEach(tab => tab.addEventListener('click', () => {
          tabs.forEach(t => t.setAttribute('aria-selected', String(t===tab)));
          panels.forEach(p => p.hidden = (p.id !== tab.getAttribute('aria-controls')));
        }));
      })();
      // Spotify: remember minimized/closed state per session
      const spotifyPlayer = document.getElementById('spotify-player-container');
      const spotifyMinimizeBtn = document.getElementById('spotify-minimize');
      const spotifyCloseBtn = document.getElementById('spotify-close');
      if(spotifyMinimizeBtn){
        spotifyMinimizeBtn.addEventListener('click', ()=>{
          spotifyPlayer.classList.toggle('minimized');
          sessionStorage.setItem('spotifyMinimized',spotifyPlayer.classList.contains('minimized')?'1':'0');
        });
        if(sessionStorage.getItem('spotifyMinimized')==='1'){
          spotifyPlayer.classList.add('minimized');
        }
      }
      if(spotifyCloseBtn){
        spotifyCloseBtn.addEventListener('click', ()=>{
          spotifyPlayer.classList.add('hidden');
          sessionStorage.setItem('spotifyClosed','1');
        });
        if(sessionStorage.getItem('spotifyClosed')==='1'){
          spotifyPlayer.classList.add('hidden');
        }
      }
      // Accessibility: skip link focus
      document.querySelector('.skip-link').addEventListener('focus',function(){this.style.left='16px';});
      // Mobile detection
      window.detectMobile = function(){
        const ua = navigator.userAgent || navigator.vendor || window.opera;
        const small = window.matchMedia('(max-width: 820px)').matches;
        const touch = ('ontouchstart' in window) || navigator.maxTouchPoints > 0;
        return small || touch || /android|iphone|ipad|ipod|iemobile|blackberry|opera mini/i.test(ua);
      };
      function applyMobile(){ document.body.classList.add('is-mobile'); }
      if(window.detectMobile()) applyMobile();
      window.addEventListener('resize', ()=>{ if(window.detectMobile()) applyMobile(); else document.body.classList.remove('is-mobile'); });
    })();
  </script>

  <!-- New Feature Scripts: Sticky Notes, Profile Gadget, Theme Switcher, Desktop Shortcuts, Command Prompt -->
<script>
(function notesFeature(){
  const KEY = "clouty_notes_v1";
  const canvas = document.getElementById('notes-canvas');
  const form = document.getElementById('note-form');
  const input = document.getElementById('note-input');
  const colorSel = document.getElementById('note-color');
  if(!canvas || !form) return;

  const sanitize = s => (s||"").replace(/[<]/g, "&lt;").slice(0,140);
  const load = () => { try { return JSON.parse(localStorage.getItem(KEY)||"[]"); } catch(_){ return []; } };
  const save = arr => localStorage.setItem(KEY, JSON.stringify(arr));

  let notes = load();
  const rnd = () => Math.random().toString(36).slice(2,10);

  function render(){
    canvas.innerHTML = "";
    notes.forEach(n => {
      const el = document.createElement('div');
      el.className = 'note';
      el.style.left = (n.x||10)+'px';
      el.style.top  = (n.y||10)+'px';
      el.style.background = n.color || '#fff8b0';
      el.dataset.id = n.id;
      el.innerHTML = `<div>${sanitize(n.text)}</div>\n        <div class="note-actions">\n          <button class="note-btn" data-act="del">Delete</button>\n        </div>`;
      canvas.appendChild(el);
      makeDraggable(el);
    });
  }

  function makeDraggable(el){
    let sx=0, sy=0, ox=0, oy=0, dragging=false;
    el.addEventListener('pointerdown', e => {
      if(e.target.closest('.note-btn')) return;
      dragging = true; el.setPointerCapture(e.pointerId);
      sx = e.clientX; sy = e.clientY;
      const r = el.getBoundingClientRect();
      ox = r.left - canvas.getBoundingClientRect().left;
      oy = r.top  - canvas.getBoundingClientRect().top;
    });
    el.addEventListener('pointermove', e => {
      if(!dragging) return;
      const nx = Math.max(0, ox + (e.clientX - sx));
      const ny = Math.max(0, oy + (e.clientY - sy));
      el.style.left = nx + 'px';
      el.style.top  = ny + 'px';
    });
    el.addEventListener('pointerup', e => {
      if(!dragging) return;
      dragging = false;
      const id = el.dataset.id;
      const n = notes.find(x=>x.id===id);
      if(n){ n.x = parseInt(el.style.left,10)||0; n.y = parseInt(el.style.top,10)||0; save(notes); }
    });
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    const text = sanitize(input.value);
    if(!text) return;
    const color = colorSel.value || '#fff8b0';
    const n = { id: rnd(), text, x: 10 + Math.floor(Math.random()*80), y: 20 + Math.floor(Math.random()*60), color };
    notes.push(n); save(notes); input.value=""; render();
  });

  canvas.addEventListener('click', e => {
    const btn = e.target.closest('.note-btn');
    if(!btn) return;
    const id = e.target.closest('.note').dataset.id;
    notes = notes.filter(n => n.id!==id); save(notes); render();
  });

  render();
})();

(function cmd(){
  const scr = document.getElementById('cmd-screen');
  const inp = document.getElementById('cmd-input');
  if(!scr || !inp) return;
  
  const write = (s="") => { const d=document.createElement('div'); d.textContent=s; scr.appendChild(d); scr.scrollTop = scr.scrollHeight; };
  const prompt = (line) => write("C:\\Users\\Guest> " + (line||""));

  const safeMath = (expr) => {
    if(!/^[0-9+\-*/().%\s^]+$/.test(expr)) return "Invalid expression";
    return Function('"use strict";return (' + expr.replace(/\^/g,'**') + ')')();
  };

  const openUrl = (u) => window.open(u.startsWith('http') ? u : `https://${u}`, '_blank');

  async function notesFetchAll() {
    const r = await fetch(NOTES_API, {cache:'no-store'}).catch(()=>null);
    if(!r || !r.ok) return null;
    return r.json();
  }
  async function notesAdd(text, color="#fff8b0") {
    const r = await fetch(NOTES_API, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({text, color, x: 20+Math.floor(Math.random()*120), y: 30+Math.floor(Math.random()*80), author: getProfileName()})}).catch(()=>null);
    return r && r.ok ? r.json() : null;
  }
  async function notesDelete(id) {
    const r = await fetch(`${NOTES_API}/${encodeURIComponent(id)}`, {method:'DELETE'}).catch(()=>null);
    return !!(r && (r.ok || r.status===204));
  }
  function getProfileName(){
    try{ const p=JSON.parse(localStorage.getItem('clouty_profile_v1')||'{}'); return p.name || 'Guest'; }catch(_){ return 'Guest'; }
  }

  function refreshNotesCanvas() {
    const ev = new Event('submit'); ev.preventDefault = ()=>{};
    const form = document.getElementById('note-form');
    if (form && typeof form.dispatchEvent === 'function') { /* noop */ }
  }

  const cmds = {
    help(){
      write("Commands:");
      write("  help                     Show this help");
      write("  clear                    Clear the console");
      write("  whoami                   Show profile name");
      write("  time                     Show local time");
      write("  calc <expr>              Calculate math (supports + - * / % ^ )");
      write("  open <url>               Open URL (e.g. open clouty-skies.com)");
      write("  goto <page>              about | blog | portfolio | watch | cloutris | tetris | home");
      write("  glass <on|off|toggle>    Control window glass effect");
      write("  wallpaper <on|off>       Show or hide wallpaper");
      write("  spotify <open|min|close> Control Spotify widget");
      write("  notes list               List shared notes");
      write("  notes add <text>         Add a shared sticky note");
      write("  notes del <id>           Delete note by id");
      write("  bsod                     Show boot overlay");
      write("  reload                   Reload the page");
    },
    clear(){ scr.innerHTML=""; },
    whoami(){ write(getProfileName()); },
    time(){ write(new Date().toString()); },
    calc(arg){
      if(!arg){ write("Usage: calc <expr>"); return; }
      try { write(String(safeMath(arg))); } catch(e){ write("Error"); }
    },
    open(arg){
      if(!arg){ write("Usage: open <url>"); return; }
      openUrl(arg); write(`Opening ${arg}...`);
    },
    goto(arg){
      const map = { home:'index.html', about:'about.html', blog:'blog.html', portfolio:'portfolio.html', watch:'watch.html', cloutris:'cloutris.html', tetris:'tetris.html' };
      const p = map[(arg||"").toLowerCase()];
      if(!p){ write("Pages: home, about, blog, portfolio, watch, cloutris, tetris"); return; }
      location.href = p;
    },
    glass(arg){
      const act=(arg||'toggle').toLowerCase();
      const winEls = document.querySelectorAll('.window');
      if(act==='on'){ winEls.forEach(w=>w.classList.add('glass')); write("Glass on"); return; }
      if(act==='off'){ winEls.forEach(w=>w.classList.remove('glass')); write("Glass off"); return; }
      winEls.forEach(w=>w.classList.toggle('glass')); write("Glass toggled");
    },
    wallpaper(arg){
      if(!arg){ write("Usage: wallpaper on|off"); return; }
      if(arg==='off'){ document.body.classList.add('no-wall'); document.body.style.background='#eef3fb'; write("Wallpaper off"); return; }
      if(arg==='on'){ document.body.classList.remove('no-wall'); document.body.style.background="#0a5fad url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1920&auto=format&fit=crop') center/cover fixed"; write("Wallpaper on"); return; }
    },
    spotify(arg){
      if(!spotify){ write("Spotify widget not found"); return; }
      const a=(arg||'').toLowerCase();
      if(a==='open'){ spotify.classList.remove('hidden'); spotify.classList.remove('minimized'); write("Spotify opened"); return; }
      if(a==='min'){ spotify.classList.toggle('minimized'); write("Spotify minimized toggled"); return; }
      if(a==='close'){ spotify.classList.add('hidden'); write("Spotify closed"); return; }
      write("Usage: spotify open|min|close");
    },
    async "notes list"(){
      const data = await notesFetchAll();
      if(!data){ write("Notes API unavailable"); return; }
      if(!data.length){ write("(no notes)"); return; }
      data.forEach(n=> write(`${n.id}: ${n.text}${n.author?` — ${n.author}`:''}`));
    },
    async "notes add"(text){
      if(!text){ write("Usage: notes add <text>"); return; }
      const n = await notesAdd(text);
      if(n){ write(`Added ${n.id}`); } else { write("Failed to add"); }
    },
    async "notes del"(id){
      if(!id){ write("Usage: notes del <id>"); return; }
      const ok = await notesDelete(id);
      write(ok ? "Deleted" : "Failed to delete");
    },
    bsod(){
      const b=document.getElementById('boot');
      if(!b){ write("Boot overlay missing"); return; }
      b.style.display='grid'; write("Boot overlay shown");
    },
    reload(){ location.reload(); }
  };

  const history = [];
  let hIdx = -1;

  const parse = (line) => {
    const t = line.trim();
    if(!t) return {cmd:"", arg:""};
    const parts = t.split(/\s+/);
    if(parts[0]==='notes' && parts[1]==='add'){ return {cmd:"notes add", arg: t.replace(/^notes\s+add\s+/i,'')}; }
    if(parts[0]==='notes' && parts[1]==='del'){ return {cmd:"notes del", arg: parts.slice(2).join(' ')}; }
    if(parts[0]==='notes' && parts[1]==='list'){ return {cmd:"notes list", arg:""}; }
    const [c, ...rest] = parts;
    return {cmd:c.toLowerCase(), arg: rest.join(' ')};
  };

  write(); // spacer

  inp.addEventListener('keydown', async (e)=>{
    if(e.key==='Enter'){
      const line = inp.value; inp.value='';
      prompt(line);
      if(!line.trim()){ write(); return; }
      history.unshift(line); hIdx = -1;

      const {cmd, arg} = parse(line);
      const fn = cmds[cmd];
      if(typeof fn === 'function'){
        const out = fn(arg);
        if(out && typeof out.then==='function') { await out; }
      } else {
        write(`'${cmd}' is not recognized as an internal or external command.`);
      }
      return;
    }
    if(e.key==='ArrowUp'){
      if(history.length && hIdx+1 < history.length){ hIdx++; inp.value = history[hIdx]; }
      e.preventDefault(); return;
    }
    if(e.key==='ArrowDown'){
      if(hIdx>0){ hIdx--; inp.value = history[hIdx]; }
      else { hIdx=-1; inp.value=""; }
      e.preventDefault(); return;
    }
  });
})();
</script>

<!-- Windows 7–styled Command Prompt logic (separate script) -->
<script>
(function(){
  if (window.__cloutyCmdInit) return; window.__cloutyCmdInit = true;

  const scr = document.getElementById('cmd-screen');
  const inp = document.getElementById('cmd-input');
  if(!scr || !inp) return;
  
  const spotify = document.getElementById('spotify-player-container');
  const notesCanvas = document.getElementById('notes-canvas');
  const NOTES_API = '/api/notes';

  const write = (s="") => { const d=document.createElement('div'); d.textContent=s; scr.appendChild(d); scr.scrollTop = scr.scrollHeight; };
  const prompt = (line) => write("C:\\Users\\Guest> " + (line||""));

  const safeMath = (expr) => {
    if(!/^[0-9+\-*/().%\s^]+$/.test(expr)) return "Invalid expression";
    return Function('"use strict";return (' + expr.replace(/\^/g,'**') + ')')();
  };

  const openUrl = (u) => window.open(u.startsWith('http') ? u : `https://${u}`, '_blank');

  async function notesFetchAll() {
    const r = await fetch(NOTES_API, {cache:'no-store'}).catch(()=>null);
    if(!r || !r.ok) return null;
    return r.json();
  }
  async function notesAdd(text, color="#fff8b0") {
    const r = await fetch(NOTES_API, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({text, color, x: 20+Math.floor(Math.random()*120), y: 30+Math.floor(Math.random()*80), author: getProfileName()})}).catch(()=>null);
    return r && r.ok ? r.json() : null;
  }
  async function notesDelete(id) {
    const r = await fetch(`${NOTES_API}/${encodeURIComponent(id)}`, {method:'DELETE'}).catch(()=>null);
    return !!(r && (r.ok || r.status===204));
  }
  function getProfileName(){
    try{ const p=JSON.parse(localStorage.getItem('clouty_profile_v1')||'{}'); return p.name || 'Guest'; }catch(_){ return 'Guest'; }
  }

  function refreshNotesCanvas() {
    const ev = new Event('submit'); ev.preventDefault = ()=>{};
    const form = document.getElementById('note-form');
    if (form && typeof form.dispatchEvent === 'function') { /* noop */ }
  }

  const cmds = {
    help(){
      write("Commands:");
      write("  help                     Show this help");
      write("  clear                    Clear the console");
      write("  whoami                   Show profile name");
      write("  time                     Show local time");
      write("  calc <expr>              Calculate math (supports + - * / % ^ )");
      write("  open <url>               Open URL (e.g. open clouty-skies.com)");
      write("  goto <page>              about | blog | portfolio | watch | cloutris | tetris | home");
      write("  glass <on|off|toggle>    Control window glass effect");
      write("  wallpaper <on|off>       Show or hide wallpaper");
      write("  spotify <open|min|close> Control Spotify widget");
      write("  notes list               List shared notes");
      write("  notes add <text>         Add a shared sticky note");
      write("  notes del <id>           Delete note by id");
      write("  bsod                     Show boot overlay");
      write("  reload                   Reload the page");
    },
    clear(){ scr.innerHTML=""; },
    whoami(){ write(getProfileName()); },
    time(){ write(new Date().toString()); },
    calc(arg){
      if(!arg){ write("Usage: calc <expr>"); return; }
      try { write(String(safeMath(arg))); } catch(e){ write("Error"); }
    },
    open(arg){
      if(!arg){ write("Usage: open <url>"); return; }
      openUrl(arg); write(`Opening ${arg}...`);
    },
    goto(arg){
      const map = { home:'index.html', about:'about.html', blog:'blog.html', portfolio:'portfolio.html', watch:'watch.html', cloutris:'cloutris.html', tetris:'tetris.html' };
      const p = map[(arg||"").toLowerCase()];
      if(!p){ write("Pages: home, about, blog, portfolio, watch, cloutris, tetris"); return; }
      location.href = p;
    },
    glass(arg){
      const act=(arg||'toggle').toLowerCase();
      const winEls = document.querySelectorAll('.window');
      if(act==='on'){ winEls.forEach(w=>w.classList.add('glass')); write("Glass on"); return; }
      if(act==='off'){ winEls.forEach(w=>w.classList.remove('glass')); write("Glass off"); return; }
      winEls.forEach(w=>w.classList.toggle('glass')); write("Glass toggled");
    },
    wallpaper(arg){
      if(!arg){ write("Usage: wallpaper on|off"); return; }
      if(arg==='off'){ document.body.classList.add('no-wall'); document.body.style.background='#eef3fb'; write("Wallpaper off"); return; }
      if(arg==='on'){ document.body.classList.remove('no-wall'); document.body.style.background="#0a5fad url('https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=1920&auto=format&fit=crop') center/cover fixed"; write("Wallpaper on"); return; }
    },
    spotify(arg){
      if(!spotify){ write("Spotify widget not found"); return; }
      const a=(arg||'').toLowerCase();
      if(a==='open'){ spotify.classList.remove('hidden'); spotify.classList.remove('minimized'); write("Spotify opened"); return; }
      if(a==='min'){ spotify.classList.toggle('minimized'); write("Spotify minimized toggled"); return; }
      if(a==='close'){ spotify.classList.add('hidden'); write("Spotify closed"); return; }
      write("Usage: spotify open|min|close");
    },
    async "notes list"(){
      const data = await notesFetchAll();
      if(!data){ write("Notes API unavailable"); return; }
      if(!data.length){ write("(no notes)"); return; }
      data.forEach(n=> write(`${n.id}: ${n.text}${n.author?` — ${n.author}`:''}`));
    },
    async "notes add"(text){
      if(!text){ write("Usage: notes add <text>"); return; }
      const n = await notesAdd(text);
      if(n){ write(`Added ${n.id}`); } else { write("Failed to add"); }
    },
    async "notes del"(id){
      if(!id){ write("Usage: notes del <id>"); return; }
      const ok = await notesDelete(id);
      write(ok ? "Deleted" : "Failed to delete");
    },
    bsod(){
      const b=document.getElementById('boot');
      if(!b){ write("Boot overlay missing"); return; }
      b.style.display='grid'; write("Boot overlay shown");
    },
    reload(){ location.reload(); }
  };

  const history = [];
  let hIdx = -1;

  const parse = (line) => {
    const t = line.trim();
    if(!t) return {cmd:"", arg:""};
    const parts = t.split(/\s+/);
    if(parts[0]==='notes' && parts[1]==='add'){ return {cmd:"notes add", arg: t.replace(/^notes\s+add\s+/i,'')}; }
    if(parts[0]==='notes' && parts[1]==='del'){ return {cmd:"notes del", arg: parts.slice(2).join(' ')}; }
    if(parts[0]==='notes' && parts[1]==='list'){ return {cmd:"notes list", arg:""}; }
    const [c, ...rest] = parts;
    return {cmd:c.toLowerCase(), arg: rest.join(' ')};
  };

  write(); // spacer

  inp.addEventListener('keydown', async (e)=>{
    if(e.key==='Enter'){
      const line = inp.value; inp.value='';
      prompt(line);
      if(!line.trim()){ write(); return; }
      history.unshift(line); hIdx = -1;

      const {cmd, arg} = parse(line);
      const fn = cmds[cmd];
      if(typeof fn === 'function'){
        const out = fn(arg);
        if(out && typeof out.then==='function') { await out; }
      } else {
        write(`'${cmd}' is not recognized as an internal or external command.`);
      }
      return;
    }
    if(e.key==='ArrowUp'){
      if(history.length && hIdx+1 < history.length){ hIdx++; inp.value = history[hIdx]; }
      e.preventDefault(); return;
    }
    if(e.key==='ArrowDown'){
      if(hIdx>0){ hIdx--; inp.value = history[hIdx]; }
      else { hIdx=-1; inp.value=""; }
      e.preventDefault(); return;
    }
  });
})();
</script>

<!-- End New Feature Scripts -->
</body>
</html>
